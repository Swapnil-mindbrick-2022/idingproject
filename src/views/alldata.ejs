<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8" />
    <title></title>
    <!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" 
integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="http://code.jquery.com/jquery-2.0.3.min.js" data-semver="2.0.3" data-require="jquery"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables_themeroller.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" />
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_table_jui.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_table.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_page.css" rel="stylesheet" data-semver="1.9.4" data-require="datatables@*" /> -->
<link data-require="jqueryui@*" data-semver="1.10.0" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.0/css/smoothness/jquery-ui-1.10.0.custom.min.css" />
<script data-require="jqueryui@*" data-semver="1.10.0" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.0/jquery-ui.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/jquery.dataTables.js" data-semver="1.9.4" data-require="datatables@*"></script> -->

<!-- <link rel='stylesheet' href='https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css'> -->
<!-- <link rel='stylesheet' href='https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.min.css'> -->
<!-- <script src='//code.jquery.com/jquery-1.12.3.js'></script> -->
<!-- <script src='https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js'></script> -->
<!-- <script src='https://cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js'></script> -->
<!-- <script src='//cdn.datatables.net/buttons/1.2.2/js/buttons.flash.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js'></script> -->
<script src='//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js'></script>
<script src='//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js'></script>
<script src='//cdn.datatables.net/buttons/1.2.2/js/buttons.html5.min.js'></script>
<script src='//cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js'></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/tom-select@2.1.0/dist/css/tom-select.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.1.0/dist/js/tom-select.complete.min.js"></script>

<!-- <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.colVis.min.js"></script> -->
<style>
  body {
	background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
	background-size: 400% 400%;
	animation: gradient 15s ease infinite;
	height: 100vh;
}

@keyframes gradient {
	0% {
		background-position: 0% 50%;
	}
	50% {
		background-position: 100% 50%;
	}
	100% {
		background-position: 0% 50%;
	}
}
/* CSS */
.popup {
  display: none;
}

.popup-button:hover .popup {
  display: block;
}







</style>

</head>
  
<body>
<div>
  <!-- <p id="date_filter" style="margin-top: 50px; margin-left: 50px;" >
    <span id="date-label-from"   class="date-label">From: </span><input class="date_range_filter date"
     type="text" id="datepicker_from" />
    <span id="date-label-to" class="date-label">To:<input class="date_range_filter date" type="text" id="datepicker_to"  />
</p> -->
<h2 style="display:flex ;justify-content: center;">Download all Raw data</h2>
<form action="/download" method="get" style="display:flex ;justify-content: center;">

  <input mbsc-input id="my-input" data-dropdown="true" data-tags="true"   hidden/>
  <select id="select-beast" placeholder="Select a AC_Name..." autocomplete="off" multiple
  name="AC_Name"  style="width:200px;font-size: 20px;background-color: black!important;" default=" ">
  


  <% data.forEach((datas)=>{%>
   
      <option value="<%= datas.AC_Name%>"><%= datas.AC_Name%></option>
      
  <%})%>
</select>
  
<input mbsc-input id="my-input0" data-dropdown="true" data-tags="true"   hidden/>
<select id="select-beast0"  placeholder="Select a Pincode..." autocomplete="off" multiple
name="Pincode" style="width:200px;font-size: 20px;background-color: white!important;" default=" ">



<% data.forEach((datas)=>{%>
 
    <option  value="<%= datas.Pincode%>"><%= datas.Pincode%></option>
    
<%})%>
</select>
<input mbsc-input id="my-input1" data-dropdown="true" data-tags="true"   hidden/>
<select id="select-beast1" placeholder="Select a Gender..." autocomplete="off" multiple
name="GENDER" style="width:200px;font-size: 20px;background-color: white!important;" default=" ">



<% data.forEach((datas)=>{%>
 
  <option value="<%= datas.GENDER%>"><%= datas.GENDER%></option>
  
<%})%>
    

</select>
  <button type="submit">submit</button>
</form>

<form form action="/products" method="POST">
  <input type="hidden" name="page" id="page" value="1">
  <div class="col-lg-3" style="display: flex;">
    <label for="sel1" style="margin-top: 5px; margin-right: 5px;">Page Size : </label>
    <input class="form-control" type="number" min="1" step="1" value="<%=perPage%>" name="perPage"
      style="width: 100px !important;">
  </div>
  <div class="col-lg-1" style="float: right;">
    <input class="btn btn-success btn-sm" type="submit" id="submit">
  </div>
</form>

<div id="container" class="m-5"></div>
  

    <table class="table table-bordered table-hover"  id="datatable" style="margin: 10px;width: 98%;">
      <thead class="table table-dark" >
        <tr>
          <!-- <th scope="col" >SR NO</th> -->
          <th scope="col" >GENDER</th>
          <th scope="col">MOBILE</th>
          <th scope="col">NAME</th>
          <th scope="col">PINCODE</th>
          <th scope="col">STATE</th>
          <th scope="col">AC Number</th>
          <th scope="col">AC Name</th>
          <% dates.forEach((date)=>{%>
            <th scope="col" class="popup-button"><%= date.date %>
            <span class="popup"> <%= date.question%></span>
         
             <% })%>
          
          
          <!-- <th scope="col">Response</th> -->
          <!-- <th scope="col">UPDATEED TIME</th> -->

        </tr>
        <!-- <tr>
          <th >Resp</th>
          <th >date</th>
        </tr> -->
      </thead>
      <tbody class="table table-hover" style="background-color: white;" >
        <%for (let i =0; i < data.length;i++){%>
          <tr>
         
            <td loading="lazy"><%= data[i].GENDER%></td>
            <td loading="lazy"><%= data[i].mobile%></td>
            <td loading="lazy"><%= data[i].Name%></td>
            <td loading="lazy"><%= data[i].Pincode%></td>
            <td loading="lazy"><%= data[i].state%></td>
            <td loading="lazy"><%= data[i].AC_Number%></td>
            <td loading="lazy"><%= data[i].AC_Name%></td>
            <% data[i].IVRS_RESPONSEs .forEach((res)=>{%>
              <td loading="lazy"><%= res.Response %></td>

           <% })%>
          </tr>
        <%}%>
      </tbody>
      <tfoot>
        <tr>
          
    
          <th  ></th>
          <th ></th>
          <th >NAME</th>
          <th >PINCODE</th>
          <th >STATE</th>
          <th >
            
          </th>
          <th >AC Name</th>
          <% dates.forEach((date)=>{%>
            <th><%= date %></th>
             <% })%>
        </tr>
      
    </tfoot>
      <div>
     

        
        <% if (Pages > 0) { %>
          <ul class="pagination text-center">
              <% if (current == 1) { %>
              <li class="disabled"><a>First</a></li>
              <% } else { %>
              <li ><a href="#" id="First" onclick="First(1)">First</a></li>
              <% } %>
          
              <% if (Number(current) - 1 > 0) { %>
              <li><a href="#" onclick="First(<%= Number(current) - 1 %>)">Prev</a></li>
              <% } else { %>
              <li class="disabled"><a>Prev</a></li>
              <% } %>
          
              <% var i = (Number(current) > 5 ? Number(current) - 4 : 1) %>
          
              <% if (i !== 1) { %>
              <li class="disabled"><a>...</a></li>
              <% } %>
          
              <% for (; i <= (Number(current) + 4) && i <= Pages; i++) { %>
          
              <% if (i == current) { %>
              <li class="active"><a><%= i %></a></li>
              <% } else { %>
              <li id="Pages"><a href="#" onclick="First(<%= i %>)" ><%= i %></a></li>
              <% } %>
          
              <% if (i == Number(current) + 4 && i < Pages) { %>
              <li class="disabled"><a>...</a></li>
              <% } %>
              <% } %>
          
              <% if (Number(current) + 1 <= Pages) { %>
              <li><a href="#" onclick="First(<%= Number(current) + 1 %>)">Next</a></li>
              <% } else { %>
              <li class="disabled"><a>Next</a></li>
              <% } %>
          
              <% if (current == Pages) { %>
              <li class="disabled"><a>Last</a></li>
              <% } else { %>
              <li><a href="#" onclick="First(<%=Pages%>)">Last</a></li>
              <% } %>
          </ul>
          <% } %>
      
          
      </div>
    </table>
    
    <button class="btn btn-success" onclick="exportData()">
        <span class="glyphicon glyphicon-download "></span>
        Download list</button>
        <h2 style="display:flex ;justify-content: center;" >Download all map data</h2>

        <form action="/mapdata" method="get" style="display:flex ;justify-content: center;">

          <input mbsc-input id="my-input2" data-dropdown="true" data-tags="true"   hidden/>
          <select id="select-beast2" placeholder="Select a AC_Name..." autocomplete="off" multiple
          name="AC_Name" style="width:200px;font-size: 20px;background-color: black!important;" default=" ">
          
        
        
          <% data.forEach((datas)=>{%>
           
              <option value="<%= datas.AC_Name%>"><%= datas.AC_Name%></option>
              
          <%})%>
        </select>
          
        <input mbsc-input id="my-input3" data-dropdown="true" data-tags="true"   hidden/>
        <select id="select-beast3" placeholder="Select a Response..." autocomplete="off" multiple
        name="Response" style="width:200px;font-size: 20px;background-color: white!important;" default=" ">
        
        
        
        <option value="YES">YES</option>
        <option value="AAP">AAP</option>
        <option value="BJP">BJP</option>
        <option value="INC">INC</option>
        <option value="OTHERS">OTHERS</option>
        </select>
        <input mbsc-input id="my-input4" data-dropdown="true" data-tags="true"   hidden/>
        <select id="select-beast4" placeholder="Select a Gender..." autocomplete="off" multiple
        name="GENDER" style="width:200px;font-size: 20px;background-color: white!important;" default=" ">
        
        
        
        <% data.forEach((datas)=>{%>
         
          <option value="<%= datas.GENDER%>"><%= datas.GENDER%></option>
          
        <%})%>
            
        
        </select>
        <input mbsc-input id="my-input5" data-dropdown="true" data-tags="true"   hidden/>
        <select id="select-beast5" placeholder="Select a date..." autocomplete="off" multiple
        name="UploadDate" style="width:200px;font-size: 20px;background-color: white!important;" default=" ">
        
        
        
        <% data.forEach((datas)=>{%>

          <% datas.IVRS_RESPONSEs.forEach((dat)=>{%>
            <option value="<%= dat.UploadDate%>"><%= dat.UploadDate%></option>

           <%})%>
         
            
            
        <%})%>
            
        
        </select>
          <button type="submit">submit</button>
        </form>
        

</div>


    <script>
// find and search by range 
function First(a) {
    document.getElementById("page").value = a;
    let button = document.getElementById('submit'); button.click();



  }
$(function() {
    var oTable = $('#datatable').DataTable({
      initComplete: function () {
            this.api()
                .columns()
                .every(function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                        .appendTo($(column.footer()).empty())
                        .on('change', function () {
                            var val = $.fn.dataTable.util.escapeRegex($(this).val());
 
                            column.search(val ? '^' + val + '$' : '', true, false).draw();
                        });
 
                    column
                        .data()
                        .unique()
                        .sort()
                        .each(function (d, j) {
                            select.append('<option value="' + d + '">' + d + '</option>');
                        });
                });
        },
        lengthMenu: [
            [10],
            [10],
        ],
    
      
      
      
      // dom: 'Bfrtip',
        // buttons: [
        //     'copy', 'excelFlash', 'excel', 'pdf', 'print','colvis',{
        //     text: 'Reload',
        //     action: function ( e, dt, node, config ) {
        //         dt.ajax.reload();
        //     }
        // }
        // ],
      
      // "oLanguage": {
      //   "sSearch": "Search:"
      // },
      
      
      // "iDisplayLength": -1,
      // "sPaginationType": "full_numbers",
  
    })
    // .container().appendTo($('#tblBtns'));
 
  
  
  
  
    $("#datepicker_from").datepicker({
      showOn: "button",
      // buttonImage: "../css/img/calendaricon.jpg",
      buttonImageOnly: false,
      "onSelect": function(date) {
        minDateFilter = new Date(date).getTime();
        oTable.fnDraw();
      }
    }).keyup(function() {
      minDateFilter = new Date(this.value).getTime();
      oTable.fnDraw();
    });
  
    $("#datepicker_to").datepicker({
      showOn: "button",
      // buttonImage: "images/calendar.gif",
      buttonImageOnly: false,
      "onSelect": function(date) {
        maxDateFilter = new Date(date).getTime();
        oTable.fnDraw();
      }
    }).keyup(function() {
      maxDateFilter = new Date(this.value).getTime();
      oTable.fnDraw();
    });
  
  });
  
  // Date range filter
  minDateFilter = "";
  maxDateFilter = "";
  
  $.fn.dataTableExt.afnFiltering.push(
    function(oSettings, aData, iDataIndex) {
      if (typeof aData._date == 'undefined') {
        aData._date = new Date(aData[0]).getTime();
      }
  
      if (minDateFilter && !isNaN(minDateFilter)) {
        if (aData._date < minDateFilter) {
          return false;
        }
      }
  
      if (maxDateFilter && !isNaN(maxDateFilter)) {
        if (aData._date > maxDateFilter) {
          return false;
        }
      }
  
      return true;
    }
  );



//  for download the data 
    function exportData(){
    /* Get the HTML data using Element by Id */
    var table = document.getElementById("datatable");
 
    /* Declaring array variable */
    var rows =[];
 
      //iterate through rows of table
    for(var i=0,row; row = table.rows[i];i++){
        //rows would be accessed using the "row" variable assigned in the for loop
        //Get each cell value/column from the row
        column1 = row.cells[0].innerText;
        column2 = row.cells[1].innerText;
        column3 = row.cells[2].innerText;
        column4 = row.cells[3].innerText;
        column5 = row.cells[4].innerText;
        column6 = row.cells[5].innerText;
        column7 = row.cells[6].innerText;
        column8 = row.cells[7].innerText;
        column9 = row.cells[8].innerText;
 
    /* add a new records in the array */
        rows.push(
            [
                column1,
                column2,
                column3,
                column4,
                column5,
                column6,
                column7,
                column8,
                column9,
                
              
            ]
        );
 
        }
        csvContent = "data:text/csv;charset=utf-8,";
         /* add the column delimiter as comma(,) and each row splitted by new line character (\n) */
        rows.forEach(function(rowArray){
            row = rowArray.join(",");
            csvContent += row + "\r\n";
        });
 
        /* create a hidden <a> DOM node and set its download attribute */
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "report.csv");
        document.body.appendChild(link);
         /* download the data file named "Stock_Price_Report.csv" */
        link.click();
}

new TomSelect("#select-beast",{
        inputElement: document.getElementById('my-input'),
	create: true,
	sortField: {
		field: "text",
		direction: "asc",
    touchUi: false
	}
});
new TomSelect("#select-beast0",{
        inputElement: document.getElementById('my-input0'),
	create: true,
	sortField: {
		field: "text",
		direction: "asc",
    touchUi: false
	}
});
new TomSelect("#select-beast1",{
        inputElement: document.getElementById('my-input1'),
	create: true,
	sortField: {
		field: "text",
		direction: "asc",
    touchUi: false
	}
});
new TomSelect("#select-beast2",{
        inputElement: document.getElementById('my-input2'),
	create: true,
	sortField: {
		field: "text",
		direction: "asc",
    touchUi: false
	}
});
new TomSelect("#select-beast3",{
        inputElement: document.getElementById('my-input3'),
	create: true,
	sortField: {
		field: "text",
		direction: "asc",
    touchUi: false
	}
});
new TomSelect("#select-beast4",{
        inputElement: document.getElementById('my-input4'),
	create: true,
	sortField: {
		field: "text",
		direction: "asc",
    touchUi: false
	}
});
new TomSelect("#select-beast5",{
        inputElement: document.getElementById('my-input5'),
	create: true,
	sortField: {
		field: "text",
		direction: "asc",
    touchUi: false
	}
});

// const $select1 = $( '.parentselect' ),
// 				$select2 = $( '.childselect' ),
// 				$options = $select2.find( 'option' );
				
// 				$select1.on( 'change', function() {
// 				$select2.html( $options.filter( '[data-state="' + this.value + '"]' ) );
// 				} ).trigger( 'change' );
    </script>
   
  </body>

</html>